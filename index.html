<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SlideSense - AI PPT Evaluator | Sairam College</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .page { display: none !important; }
        .page.active { display: block !important; }
        #login-page.active { display: flex !important; }
        .modal { display: none; }
        .modal.active { display: flex; }
        .kanban-column { min-height: 400px; }
        .dragging { opacity: 0.5; }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <!-- LOGIN PAGE -->
    <div id="login-page" class="page active min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="bg-blue-600 rounded-xl p-4 inline-block mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 text-white">
                        <path d="M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z"></path>
                        <path d="M22 10v6"></path>
                        <path d="M6 12.5V16a6 3 0 0 0 12 0v-3.5"></path>
                    </svg>
                </div>
                <h1 class="text-3xl font-bold text-gray-900 mb-2">SlideSense</h1>
                <p class="text-gray-600 font-medium">AI-Powered PPT Evaluator</p>
                <p class="text-sm text-gray-500 mt-1">Sairam College of Engineering</p>
            </div>

            <div class="mb-6">
                <div class="flex gap-2 bg-gray-100 p-1 rounded-lg">
                    <button id="btn-staff" onclick="selectUserType('staff')" class="flex-1 py-2 px-4 rounded-md font-medium transition-all bg-blue-600 text-white shadow-md">
                        Staff
                    </button>
                    <button id="btn-student" onclick="selectUserType('student')" class="flex-1 py-2 px-4 rounded-md font-medium transition-all text-gray-700 hover:bg-gray-200">
                        Student
                    </button>
                </div>
            </div>

            <div class="space-y-4">
                <input type="hidden" id="user-type" value="staff">
                
                <div id="error-message" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm"></div>

                <button type="button" onclick="handleDirectLogin()" class="w-full bg-blue-600 text-white py-3 rounded-md font-medium hover:bg-blue-700 transition-all shadow-lg">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <!-- STAFF DASHBOARD (KANBAN) -->
    <div id="staff-page" class="page min-h-screen bg-gray-50">
        <header class="bg-white border-b border-gray-200 px-6 py-4">
            <div class="max-w-7xl mx-auto flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="bg-blue-600 rounded-xl p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 text-white">
                            <path d="M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-gray-900 text-2xl font-medium" id="staff-header">Staff Dashboard</h1>
                        <p class="text-gray-500 text-sm">AI Document Tracking System</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="handleLogout()" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all h-9 px-4 py-2 text-gray-600 hover:bg-gray-50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4">
                            <path d="m16 17 5-5-5-5"></path>
                            <path d="M21 12H9"></path>
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        </svg>
                        Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-6 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8" id="staff-stats">
                <!-- Stats loaded here -->
            </div>

            <!-- Kanban Board -->
            <div class="mb-8">
                <h2 class="text-2xl font-medium mb-4">Project Review Board</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4" id="kanban-board">
                    <!-- Applied Column -->
                    <div class="kanban-column bg-gray-100 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
                            <span class="bg-blue-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs" id="applied-count">0</span>
                            Applied
                        </h3>
                        <div id="applied-column" class="space-y-3" ondrop="handleDrop(event, 'applied')" ondragover="handleDragOver(event)"></div>
                    </div>

                    <!-- Reviewing Column -->
                    <div class="kanban-column bg-gray-100 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
                            <span class="bg-yellow-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs" id="reviewing-count">0</span>
                            Reviewing
                        </h3>
                        <div id="reviewing-column" class="space-y-3" ondrop="handleDrop(event, 'reviewing')" ondragover="handleDragOver(event)"></div>
                    </div>

                    <!-- Accepted Column -->
                    <div class="kanban-column bg-gray-100 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
                            <span class="bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs" id="accepted-count">0</span>
                            Accepted
                        </h3>
                        <div id="accepted-column" class="space-y-3" ondrop="handleDrop(event, 'accepted')" ondragover="handleDragOver(event)"></div>
                    </div>

                    <!-- Rejected Column -->
                    <div class="kanban-column bg-gray-100 rounded-lg p-4">
                        <h3 class="font-semibold text-gray-700 mb-4 flex items-center gap-2">
                            <span class="bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs" id="rejected-count">0</span>
                            Rejected
                        </h3>
                        <div id="rejected-column" class="space-y-3" ondrop="handleDrop(event, 'rejected')" ondragover="handleDragOver(event)"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STUDENT DASHBOARD -->
    <div id="student-page" class="page min-h-screen bg-gray-50">
        <header class="bg-white border-b border-gray-200 px-6 py-4">
            <div class="max-w-7xl mx-auto flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="bg-blue-600 rounded-xl p-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 text-white">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-gray-900 text-2xl font-medium" id="student-header">Student Dashboard</h1>
                        <p class="text-gray-500 text-sm">PPT Submission & Tracking System</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="handleLogout()" class="inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all h-9 px-4 py-2 text-gray-600 hover:bg-gray-50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4">
                            <path d="m16 17 5-5-5-5"></path>
                            <path d="M21 12H9"></path>
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        </svg>
                        Logout
                    </button>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-6 py-8">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8" id="student-stats">
                <!-- Stats loaded here -->
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4 mb-8">
                <button onclick="openUploadModal()" class="flex items-center gap-2 px-6 py-3 rounded-xl transition-all bg-blue-600 text-white shadow-lg hover:bg-blue-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    Upload New PPT
                </button>
            </div>

            <!-- My Submissions -->
            <div id="submissions-section">
                <div class="mb-8">
                    <h2 class="text-gray-900 text-2xl font-medium mb-2">My Presentations</h2>
                    <p class="text-gray-600">Track your submission status and scores</p>
                </div>

                <div id="my-presentations-list" class="space-y-4">
                    <!-- Presentations loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="upload-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center">
        <div class="bg-white rounded-2xl p-6 max-w-2xl w-full mx-4">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-medium">Upload New Presentation</h3>
                <button onclick="closeModal('upload-modal')" class="text-gray-500 hover:text-gray-700">‚úï</button>
            </div>
            <form onsubmit="handleUpload(event)" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">Presentation File (PPT/PDF)</label>
                    <input type="file" id="ppt-file" accept=".pptx,.ppt,.pdf" required class="w-full border border-gray-300 rounded-md p-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Presentation Title</label>
                    <input type="text" id="ppt-title" placeholder="e.g., AI_Machine_Learning_Presentation" required class="w-full border border-gray-300 rounded-md p-2">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Department</label>
                        <select id="ppt-dept" required class="w-full border border-gray-300 rounded-md p-2">
                            <option value="CSE">CSE</option>
                            <option value="EEE">EEE</option>
                            <option value="MECH">MECH</option>
                            <option value="CIVIL">CIVIL</option>
                            <option value="PHYSICS">PHYSICS</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-2">Number of Slides</label>
                        <input type="number" id="ppt-slides" min="1" required class="w-full border border-gray-300 rounded-md p-2">
                    </div>
                </div>
                <div class="flex gap-3">
                    <button type="submit" class="flex-1 bg-blue-600 text-white rounded-md py-2 hover:bg-blue-700">Upload</button>
                    <button type="button" onclick="closeModal('upload-modal')" class="flex-1 bg-gray-200 text-gray-700 rounded-md py-2 hover:bg-gray-300">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Analysis Modal -->
    <div id="analysis-modal" class="modal fixed inset-0 bg-black bg-opacity-50 z-50 items-center justify-center">
        <div class="bg-white rounded-2xl p-6 max-w-3xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-medium">AI Analysis Report</h3>
                <button onclick="closeModal('analysis-modal')" class="text-gray-500 hover:text-gray-700">‚úï</button>
            </div>
            <div id="analysis-content"></div>
        </div>
    </div>

    <script>
        // ============ GLOBAL STATE ============
        const API_BASE = 'http://localhost:5000/api';
        let currentUserType = 'staff';
        let currentUser = null;
        let submissions = [];
        let dragElement = null;

        // ============ PAGE NAVIGATION ============
        function showPage(pageId) {
            console.log('Showing page:', pageId);
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
            });
            
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
                console.log('Page activated:', pageId);
            } else {
                console.error('Page not found:', pageId);
            }
        }

        // ============ LOGIN FUNCTIONALITY ============
        function handleDirectLogin() {
            const userType = document.getElementById('user-type').value || currentUserType;
            console.log('Direct login - User Type:', userType);
            
            // Set default authentication values
            localStorage.setItem('isAuthenticated', 'true');
            localStorage.setItem('userType', userType);
            localStorage.setItem('userId', '1');
            localStorage.setItem('token', `${userType}_1_${Date.now()}`);
            
            if (userType === 'staff') {
                // Set default staff values
                localStorage.setItem('userName', 'Dr. John Smith');
                localStorage.setItem('userEmail', 'teacher@example.com');
                currentUser = {
                    type: 'staff',
                    id: '1',
                    name: 'Dr. John Smith',
                    email: 'teacher@example.com'
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                console.log('Redirecting to staff.html...');
                window.location.replace('staff.html');
            } else {
                // Set default student values
                localStorage.setItem('userName', 'Rahul Kumar');
                localStorage.setItem('rollNumber', '21CS001');
                localStorage.setItem('department', 'CSE');
                currentUser = {
                    type: 'student',
                    id: '1',
                    name: 'Rahul Kumar',
                    rollNumber: '21CS001',
                    department: 'CSE'
                };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                console.log('Redirecting to student.html...');
                window.location.replace('student.html');
            }
        }
        
        function selectUserType(type) {
            console.log('Selecting user type:', type);
            currentUserType = type;
            const userTypeInput = document.getElementById('user-type');
            if (userTypeInput) {
                userTypeInput.value = type;
            }
            
            const staffBtn = document.getElementById('btn-staff');
            const studentBtn = document.getElementById('btn-student');
            
            if (type === 'staff') {
                if (staffBtn) {
                    staffBtn.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                    staffBtn.classList.remove('text-gray-700', 'hover:bg-gray-200');
                }
                if (studentBtn) {
                    studentBtn.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                    studentBtn.classList.add('text-gray-700', 'hover:bg-gray-200');
                }
            } else {
                if (studentBtn) {
                    studentBtn.classList.add('bg-blue-600', 'text-white', 'shadow-md');
                    studentBtn.classList.remove('text-gray-700', 'hover:bg-gray-200');
                }
                if (staffBtn) {
                    staffBtn.classList.remove('bg-blue-600', 'text-white', 'shadow-md');
                    staffBtn.classList.add('text-gray-700', 'hover:bg-gray-200');
                }
            }
            
            const errorMsg = document.getElementById('error-message');
            if (errorMsg) {
                errorMsg.classList.add('hidden');
            }
        }

        async function handleLogin(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const errorDiv = document.getElementById('error-message');
            errorDiv.classList.add('hidden');
            
            const userType = document.getElementById('user-type').value || currentUserType;
            console.log('Login attempt - User Type:', userType);
            
            let loginData = {};
            
            if (userType === 'staff') {
                const email = document.getElementById('staff-email').value;
                const password = document.getElementById('staff-password').value;
                loginData = {
                    email: email,
                    password: password,
                    userType: 'staff'
                };
            } else {
                const rollNumber = document.getElementById('student-roll').value;
                const password = document.getElementById('student-password').value;
                loginData = {
                    rollNumber: rollNumber,
                    password: password,
                    userType: 'student'
                };
            }
            
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(loginData)
                });
                
                const result = await response.json();
                
                if (response.ok && result.success) {
                    console.log('Login successful - User:', result);
                    
                    // Store session data
                    localStorage.setItem('isAuthenticated', 'true');
                    localStorage.setItem('userType', result.userType);
                    localStorage.setItem('userId', result.userId);
                    localStorage.setItem('userName', result.userName);
                    localStorage.setItem('token', result.token);
                    
                    // Store user data
                    currentUser = {
                        type: result.userType,
                        id: result.userId,
                        name: result.userName,
                        email: result.email,
                        rollNumber: result.rollNumber,
                        department: result.department
                    };
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // Set user-specific data and redirect
                    if (userType === 'staff') {
                        if (result.email) localStorage.setItem('userEmail', result.email);
                        console.log('Redirecting to staff.html...');
                        // Use replace to avoid back button issues
                        window.location.replace('staff.html');
                    } else {
                        if (result.rollNumber) localStorage.setItem('rollNumber', result.rollNumber);
                        if (result.department) localStorage.setItem('department', result.department);
                        console.log('Redirecting to student.html...');
                        // Use replace to avoid back button issues
                        window.location.replace('student.html');
                    }
                } else {
                    console.log('Login failed - Invalid credentials');
                    errorDiv.textContent = result.message || 'Invalid credentials. Please try again.';
                    errorDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Login error:', error);
                errorDiv.textContent = 'Error connecting to server. Make sure backend is running on http://localhost:5000';
                errorDiv.classList.remove('hidden');
            }
            
            return false;
        }

        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.clear();
                currentUser = null;
                showPage('login-page');
            }
        }

        // Check authentication on load
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOM Content Loaded');
            
            // Initialize submissions first
            submissions = [...mockSubmissions];
            
            // Check for existing authentication
            const auth = localStorage.getItem('isAuthenticated');
            const userType = localStorage.getItem('userType');
            const userStr = localStorage.getItem('currentUser');
            
            if (auth === 'true' && userType && userStr) {
                try {
                    currentUser = JSON.parse(userStr);
                    console.log('Found authenticated user, redirecting...', currentUser);
                    
                    // Redirect to appropriate page
                    if (userType === 'staff') {
                        window.location.href = 'staff.html';
                    } else if (userType === 'student') {
                        window.location.href = 'student.html';
                    } else {
                        showPage('login-page');
                        setTimeout(() => {
                            selectUserType('staff');
                        }, 100);
                    }
                } catch (e) {
                    console.error('Error parsing user data:', e);
                    showPage('login-page');
                    setTimeout(() => {
                        selectUserType('staff');
                    }, 100);
                }
            } else {
                console.log('No authentication found, showing login page');
                showPage('login-page');
                // Initialize user type selector after a short delay
                setTimeout(() => {
                    selectUserType('staff');
                }, 100);
            }
        });

        // ============ STAFF DASHBOARD ============
        function loadStaffDashboard() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (user) {
                document.getElementById('staff-header').textContent = `Staff Dashboard - ${user.name}`;
            }
            
            loadStaffStats();
            loadKanbanBoard();
        }

        function loadStaffStats() {
            const stats = {
                total: submissions.length,
                applied: submissions.filter(s => s.status === 'applied').length,
                reviewing: submissions.filter(s => s.status === 'reviewing').length,
                accepted: submissions.filter(s => s.status === 'accepted').length,
                rejected: submissions.filter(s => s.status === 'rejected').length
            };
            
            document.getElementById('staff-stats').innerHTML = `
                <div class="bg-blue-50 rounded-2xl p-6 border border-blue-100">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-blue-600 text-sm mb-1">Total Submissions</p>
                            <p class="text-blue-900 text-4xl font-medium">${stats.total}</p>
                        </div>
                    </div>
                </div>
                <div class="bg-yellow-50 rounded-2xl p-6 border border-yellow-100">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-yellow-700 text-sm mb-1">Reviewing</p>
                            <p class="text-yellow-900 text-4xl font-medium">${stats.reviewing}</p>
                        </div>
                    </div>
                </div>
                <div class="bg-green-50 rounded-2xl p-6 border border-green-100">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-green-600 text-sm mb-1">Accepted</p>
                            <p class="text-green-900 text-4xl font-medium">${stats.accepted}</p>
                        </div>
                    </div>
                </div>
                <div class="bg-red-50 rounded-2xl p-6 border border-red-100">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-red-600 text-sm mb-1">Rejected</p>
                            <p class="text-red-900 text-4xl font-medium">${stats.rejected}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadKanbanBoard() {
            const columns = {
                applied: document.getElementById('applied-column'),
                reviewing: document.getElementById('reviewing-column'),
                accepted: document.getElementById('accepted-column'),
                rejected: document.getElementById('rejected-column')
            };
            
            // Clear columns
            Object.values(columns).forEach(col => col.innerHTML = '');
            
            // Populate columns
            submissions.forEach(submission => {
                const card = createKanbanCard(submission);
                columns[submission.status].appendChild(card);
            });
            
            // Update counts
            document.getElementById('applied-count').textContent = submissions.filter(s => s.status === 'applied').length;
            document.getElementById('reviewing-count').textContent = submissions.filter(s => s.status === 'reviewing').length;
            document.getElementById('accepted-count').textContent = submissions.filter(s => s.status === 'accepted').length;
            document.getElementById('rejected-count').textContent = submissions.filter(s => s.status === 'rejected').length;
        }

        function createKanbanCard(submission) {
            const card = document.createElement('div');
            card.className = 'bg-white rounded-lg p-4 shadow-md cursor-move hover:shadow-lg transition-shadow';
            card.draggable = true;
            card.id = `card-${submission.id}`;
            card.ondragstart = (e) => handleDragStart(e, submission.id);
            card.ondragend = (e) => handleDragEnd(e);
            
            card.innerHTML = `
                <div class="mb-2">
                    <h4 class="font-semibold text-sm text-gray-900 truncate">${submission.fileName}</h4>
                    <p class="text-xs text-gray-500">${submission.studentName}</p>
                </div>
                <div class="flex items-center justify-between mb-2">
                    <span class="text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded">${submission.department}</span>
                    ${submission.score ? `<span class="text-xs font-semibold text-green-600">${submission.score}%</span>` : ''}
                </div>
                ${submission.score ? `
                <div class="w-full bg-gray-200 rounded-full h-1.5 mb-2">
                    <div class="bg-green-500 h-1.5 rounded-full" style="width: ${submission.score}%"></div>
                </div>
                ` : ''}
                <button onclick="viewJustification('${submission.id}')" class="text-xs text-blue-600 hover:text-blue-800 w-full text-left">
                    View AI Analysis ‚Üí
                </button>
            `;
            
            return card;
        }

        // ============ DRAG AND DROP ============
        function handleDragStart(e, submissionId) {
            dragElement = submissionId;
            e.dataTransfer.effectAllowed = 'move';
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e, newStatus) {
            e.preventDefault();
            
            if (dragElement) {
                const submission = submissions.find(s => s.id === dragElement);
                if (submission) {
                    submission.status = newStatus;
                    loadKanbanBoard();
                    loadStaffStats();
                }
                dragElement = null;
            }
        }

        function viewJustification(submissionId) {
            const submission = submissions.find(s => s.id === submissionId);
            if (!submission) return;
            
            document.getElementById('analysis-content').innerHTML = `
                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-medium mb-2">Document: ${submission.fileName}</h4>
                        <p class="text-sm text-gray-600">Student: ${submission.studentName} (${submission.rollNumber})</p>
                    </div>
                    ${submission.score ? `
                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-medium mb-2">AI Score: ${submission.score}%</h4>
                    </div>
                    ` : ''}
                    <div>
                        <h4 class="font-medium mb-2">AI Justification:</h4>
                        <p class="text-gray-700">${submission.justification || 'Analysis pending...'}</p>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">Evaluation Criteria:</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-600">
                            <li>Conceptual Clarity: 30%</li>
                            <li>Technical Feasibility: 30%</li>
                            <li>Innovation: 20%</li>
                            <li>Presentation Quality: 10%</li>
                            <li>Relevance to Theme: 10%</li>
                        </ul>
                    </div>
                </div>
            `;
            document.getElementById('analysis-modal').classList.add('active');
        }

        // ============ STUDENT DASHBOARD ============
        function loadStudentDashboard() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if (user) {
                document.getElementById('student-header').textContent = `Student Dashboard - ${user.name}`;
            }
            
            loadStudentStats();
            loadMyPresentations();
        }

        function loadStudentStats() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            const studentSubmissions = submissions.filter(s => s.rollNumber === user.rollNumber);
            const scores = studentSubmissions.filter(s => s.score > 0).map(s => s.score);
            const avgScore = scores.length > 0 ? (scores.reduce((a, b) => a + b, 0) / scores.length).toFixed(1) : 0;
            
            document.getElementById('student-stats').innerHTML = `
                <div class="bg-blue-50 rounded-2xl p-6 border border-blue-100">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-blue-600 text-sm mb-1">Total Submissions</p>
                            <p class="text-blue-900 text-4xl font-medium">${studentSubmissions.length}</p>
                        </div>
                    </div>
                </div>
                <div class="bg-yellow-50 rounded-2xl p-6 border border-yellow-100">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-yellow-700 text-sm mb-1">Pending Review</p>
                            <p class="text-yellow-900 text-4xl font-medium">${studentSubmissions.filter(s => s.status === 'applied' || s.status === 'reviewing').length}</p>
                        </div>
                    </div>
                </div>
                <div class="bg-green-50 rounded-2xl p-6 border border-green-100">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-green-600 text-sm mb-1">Accepted</p>
                            <p class="text-green-900 text-4xl font-medium">${studentSubmissions.filter(s => s.status === 'accepted').length}</p>
                        </div>
                    </div>
                </div>
                <div class="bg-purple-50 rounded-2xl p-6 border border-purple-100">
                    <div class="flex items-start justify-between">
                        <div>
                            <p class="text-purple-600 text-sm mb-1">Average Score</p>
                            <p class="text-purple-900 text-4xl font-medium">${avgScore}%</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function loadMyPresentations() {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            const studentSubmissions = submissions.filter(s => s.rollNumber === user.rollNumber);
            const container = document.getElementById('my-presentations-list');
            
            if (studentSubmissions.length === 0) {
                container.innerHTML = '<div class="text-center py-12 text-gray-500">No submissions yet. Click "Upload New PPT" to get started!</div>';
                return;
            }
            
            container.innerHTML = studentSubmissions.map(s => {
                const statusConfig = {
                    applied: { badge: 'bg-blue-100 text-blue-700', label: 'Applied' },
                    reviewing: { badge: 'bg-yellow-100 text-yellow-700', label: 'Reviewing' },
                    accepted: { badge: 'bg-green-100 text-green-700', label: '‚úì Accepted' },
                    rejected: { badge: 'bg-red-100 text-red-700', label: '‚úó Rejected' }
                };
                const config = statusConfig[s.status] || statusConfig.applied;
                
                return `
                    <div class="bg-white rounded-2xl p-6 border border-gray-200">
                        <div class="flex items-start gap-4">
                            <div class="bg-gradient-to-br from-blue-500 to-purple-500 rounded-xl p-4 flex-shrink-0">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-8 h-8 text-white">
                                    <path d="M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z"></path>
                                </svg>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-start justify-between mb-4">
                                    <div>
                                        <h3 class="text-blue-600 mb-2 font-medium">${s.fileName}</h3>
                                        <div class="flex items-center gap-4 text-sm text-gray-600 flex-wrap">
                                            <span>üè´ ${s.department}</span>
                                            <span>üìÑ ${s.slideCount} slides</span>
                                            <span class="inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium ${config.badge}">${config.label}</span>
                                        </div>
                                    </div>
                                    <div class="text-right">
                                        ${s.score ? `<div class="text-2xl px-4 py-2 rounded-xl mb-2 bg-green-500 text-white font-medium">${s.score}%</div>` : '<div class="text-sm text-gray-500 mb-2">Awaiting Review</div>'}
                                        <p class="text-gray-500 text-sm">üìÖ ${s.uploadDate}</p>
                                    </div>
                                </div>
                                ${s.score ? `
                                <div class="mb-4">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-600 h-2 rounded-full" style="width: ${s.score}%"></div>
                                    </div>
                                </div>
                                ` : ''}
                                ${s.justification ? `
                                <button onclick="viewStudentAnalysis('${s.id}')" class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md text-sm">
                                    View AI Analysis
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function viewStudentAnalysis(submissionId) {
            const submission = submissions.find(s => s.id === submissionId);
            if (!submission) return;
            
            document.getElementById('analysis-content').innerHTML = `
                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-medium mb-2">Overall Score: ${submission.score}%</h4>
                    </div>
                    <div>
                        <h4 class="font-medium mb-2">AI Justification:</h4>
                        <p class="text-gray-700">${submission.justification}</p>
                    </div>
                </div>
            `;
            document.getElementById('analysis-modal').classList.add('active');
        }

        function openUploadModal() {
            document.getElementById('upload-modal').classList.add('active');
        }

        function handleUpload(event) {
            event.preventDefault();
            
            const fileInput = document.getElementById('ppt-file');
            const title = document.getElementById('ppt-title').value;
            const dept = document.getElementById('ppt-dept').value;
            const slides = parseInt(document.getElementById('ppt-slides').value);
            const user = JSON.parse(localStorage.getItem('currentUser'));
            
            if (!fileInput.files[0]) {
                alert('Please select a file');
                return;
            }
            
            // Simulate AI scoring (will be replaced with Gemini API)
            const score = Math.floor(Math.random() * 25) + 75; // 75-100
            
            const newSubmission = {
                id: Date.now().toString(),
                fileName: fileInput.files[0].name,
                studentName: user.name,
                rollNumber: user.rollNumber,
                department: dept,
                slideCount: slides,
                status: 'applied',
                score: score,
                uploadDate: new Date().toLocaleString('en-US', { month: '2-digit', day: '2-digit', year: 'numeric', hour: '2-digit', minute: '2-digit' }),
                justification: 'Document analysis complete. Strong conceptual foundation with good presentation structure.'
            };
            
            submissions.push(newSubmission);
            
            alert('Presentation uploaded successfully! AI analysis is being processed.');
            closeModal('upload-modal');
            document.getElementById('ppt-file').value = '';
            document.getElementById('ppt-title').value = '';
            document.getElementById('ppt-slides').value = '';
            
            loadStudentStats();
            loadMyPresentations();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
    </script>
</body>
</html>

